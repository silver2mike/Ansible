pipeline {
  agent {label 'Ansible'}
  environment {
    ANSIBLE_PK=credentials('AWS-ProdServer-private-key')
  }
  stages {
    stage('Update ProdServer') {
      steps {
      withCredentials([$class: 'AmazonWebServicesCredentialsBinding',
                      credentialsId: 'awsID',
                      accessKeyVariable: 'AWS_ACCESS_KEY_ID',
                      secretKeyVariable: 'AWS_SECRET_ACCESS_KEY'])
                      
        sh 'ansible-playbook --private-key=$ANSIBLE_PK -i aws_ec2.yaml prod.yml'
      }
    }
  }
}
