pipeline {
  agent {label 'Ansible'}
  environment {
    ANSIBLE_PK            = credentials('AWS-ProdServer-private-key')
  }
  stages {
    stage('Update ProdServer') {
      steps {
        withCredentials([[
          $class: 'AmazonWebServicesCredentialsBinding', 
          credentialsId: 'AWS_EC2_Inventory', 
          accessKeyVariable: 'AWS_ACCESS_KEY_ID', 
          secretKeyVariable: 'AWS_SECRET_ACCESS_KEY']]) {
            sh '''
            echo $AWS_ACCESS_KEY_ID
            ansible-playbook --private-key=$ANSIBLE_PK -i aws_ec2.yaml prod.yml
            '''
        }
      }
    }
  }
}
